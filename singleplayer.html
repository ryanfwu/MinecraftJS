<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="./assets/img/favicon.png">
        <link rel="stylesheet" href="./css/game.css">
        <title>MinecraftJS | Singleplayer</title>
        <script src="https://cdn.babylonjs.com/babylon.max.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    </head>
    <body>
        <canvas id="canvas" onclick="this.requestPointerLock();"></canvas>
        <script>
            window.addEventListener('DOMContentLoaded', function(){
                var canvas = document.getElementById('canvas');
                var engine = new BABYLON.Engine(canvas, true);
                var yaw = 0;
                var pitch = 0;
                var jump = false;
                
                window.onkeyup = function cameraJump(event) {
                    if (event.keyCode == 32) {
                        jump = true;
                    }
                }
                
                var createScene = function(){
                    var scene = new BABYLON.Scene(engine);
                    scene.clearColor = new BABYLON.Color3(0.529, 0.808, 0.922);
                    scene.gravity = new BABYLON.Vector3(0, -0.1635, 0);
                    scene.collisionsEnabled = true;
                    
                    var light = new BABYLON.PointLight("light", new BABYLON.Vector3(0, 100, -10), scene);
                    light.intensity = 1;
                    light.radius = 10000;
                    
                    var camera = new BABYLON.UniversalCamera('camera', new BABYLON.Vector3(0, 5,-10), scene);
                    camera.setTarget(BABYLON.Vector3.Zero());
                    camera.rotation.x = BABYLON.Tools.ToRadians(yaw);
                    camera.rotation.y = BABYLON.Tools.ToRadians(pitch);
                    camera.applyGravity = true;
                    camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
                    camera.checkCollisions = true;
                    camera.attachControl(canvas,true);
                    camera.keysUp.push(87);
                    camera.keysDown.push(83)
                    camera.keysLeft.push(65);
                    camera.keysRight.push(68);
                    camera.sensibility = 0.01;
                    camera.inertia = 0;
                    camera.speed = 0.75;
                    
                    if (jump) {
                        camera.position.y += 4;
                        jump = false;
                    }
                    
                    var groundTexture = new BABYLON.StandardMaterial("groundTexture", scene);
                    groundTexture.specularColor = new BABYLON.Color3(0.51, 0.39, 0.22);
                    var ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 100, height: 100});
                    ground.material = groundTexture;
                    ground.checkCollisions = true;

                    return scene;
                }
              
                var scene = createScene();
                    engine.runRenderLoop(function(){
                    scene.render();
                });
                
                canvas.requestPointerLock = canvas.requestPointerLock || canvas.mozRequestPointerLock;
                canvas.requestPointerLock();
            });
        </script>
    </body>
</html>
