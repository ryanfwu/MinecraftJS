<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="./assets/img/favicon.png">
        <link rel="stylesheet" href="./css/game.css">
        <title>MinecraftJS | Singleplayer</title>
        <script src="https://cdn.babylonjs.com/babylon.max.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    </head>
    <body>
        <canvas id="canvas" onclick="this.requestPointerLock();"></canvas>
        <script>
            window.addEventListener('DOMContentLoaded', function(){
                var canvas = document.getElementById('canvas');
                var engine = new BABYLON.Engine(canvas, true);
                var walkplaying = false;
                
                var createScene = function(){
                    var scene = new BABYLON.Scene(engine);
                    scene.clearColor = new BABYLON.Color3(0.529, 0.808, 0.922);
                    scene.gravity = new BABYLON.Vector3(0, -0.1635, 0);
                    scene.collisionsEnabled = true;
                    
                    var light = new BABYLON.PointLight("light", new BABYLON.Vector3(0, 100, -10), scene);
                    light.intensity = 1;
                    light.radius = 10000;
                    
                    var camera = new BABYLON.UniversalCamera('camera', new BABYLON.Vector3(0, 5,-10), scene);
                    camera.setTarget(BABYLON.Vector3.Zero());
                    camera.applyGravity = true;
                    camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
                    camera.checkCollisions = true;
                    camera.attachControl(canvas,true);
                    camera.keysUp.push(87);
                    camera.keysDown.push(83)
                    camera.keysLeft.push(65);
                    camera.keysRight.push(68);
                    camera.sensibility = 0.01;
                    camera.inertia = 0;
                    camera.speed = 0.75;
                    
                    var groundTexture = new BABYLON.StandardMaterial("groundTexture", scene);
                    groundTexture.specularColor = new BABYLON.Color3(0.51, 0.39, 0.22);
                    var ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 100, height: 100});
                    ground.material = groundTexture;
                    ground.checkCollisions = true;
                    
                    var walk1 = new BABYLON.Sound("Walk1", "./assets/sounds/walk1.ogg", scene);
                    var walk2 = new BABYLON.Sound("Walk2", "./assets/sounds/walk2.ogg", scene);
                    var walk3 = new BABYLON.Sound("Walk3", "./assets/sounds/walk3.ogg", scene);
                    var walk4 = new BABYLON.Sound("Walk4", "./assets/sounds/walk4.ogg", scene);
                    var walk5 = new BABYLON.Sound("Walk5", "./assets/sounds/walk5.ogg", scene);
                    var walk6 = new BABYLON.Sound("Walk6", "./assets/sounds/walk6.ogg", scene);
                    
                    window.addEventListener("keydown", function(event) {
                        if ((event.keyCode == 87 || event.keyCode == 65) || (event.keyCode == 83 || event.keyCode == 68)) {
                            if (walkplaying == false) {
                                var walknumber = Math.floor(Math.random() * 6) + 1;
                                switch (walknumber) {
                                    case 1:
                                        walk1.play();
                                        break;
                                    case 2:
                                        walk2.play();
                                        break;
                                    case 3:
                                        walk3.play();
                                        break;
                                    case 4:
                                        walk4.play();
                                        break;
                                    case 5:
                                        walk5.play();
                                        break;
                                    case 6:
                                        walk6.play();
                                        break;
                                    default:
                                        walk1.play();
                                }
                                walkplaying = true;
                                setTimeout(function() {
                                    walkplaying = false;
                                }, 450);
                            }
                        }
                    });
                                            
                    var music = new BABYLON.Sound("Music", "./assets/sounds/music.mp3", scene, null, {loop: true, autoplay: true});
                    music.play();

                    return scene;
                }
              
                var scene = createScene();
                    engine.runRenderLoop(function(){
                    scene.render();
                });
                
                canvas.requestPointerLock = canvas.requestPointerLock || canvas.mozRequestPointerLock;
                canvas.requestPointerLock();
            });
        </script>
    </body>
</html>
